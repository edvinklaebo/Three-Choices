using UnityEngine;

/// <summary>
/// Increases damage dealt to a specific target.
/// Applied as an early modifier (priority 50) before multiplicative effects.
/// </summary>
public class VulnerabilityModifier : IDamageModifier
{
    public int Priority => 50; // Early modifier, affects base before multipliers

    private readonly Unit _affectedTarget;
    private readonly float _damageIncrease;

    /// <param name="affectedTarget">The target that takes increased damage</param>
    /// <param name="damageIncrease">Multiplier for damage (e.g., 1.5 = +50% damage)</param>
    public VulnerabilityModifier(Unit affectedTarget, float damageIncrease)
    {
        _affectedTarget = affectedTarget;
        _damageIncrease = damageIncrease;
    }

    public void Modify(DamageContext ctx)
    {
        if (ctx.Target != _affectedTarget) return;

        var oldValue = ctx.FinalValue;
        ctx.FinalValue = Mathf.CeilToInt(ctx.FinalValue * _damageIncrease);

        Log.Info("Vulnerability modifier applied", new
        {
            target = _affectedTarget.Name,
            source = ctx.Source?.Name,
            multiplier = _damageIncrease,
            before = oldValue,
            after = ctx.FinalValue
        });
    }
}
